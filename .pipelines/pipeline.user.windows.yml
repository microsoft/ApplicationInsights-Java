environment:
  host:
    os: 'windows'
    flavor: 'server'
    version: '2019'
  runtime:
    provider: 'appcontainer'
    image: 'cdpxwin1809.azurecr.io/global/vse2019:latest'
    source_mode: 'map'
signing_options:
  profile: '170'
restore:
  commands:
    - !!defaultcommand
      name: 'Download collectd-api.jar'
      command: '.scripts/downloadCollectdJar.cmd'
    - !!defaultcommand
      name: 'Install Windows 8.1 SDK'
      command: '.scripts/installWindows81SDK.cmd'
      logs:
        - from: 'AIJ-BuildLogs/Restore/WinSdk'
          to: 'Build Logs/Restore/WinSdk'
          include:
            - '**/*.log'
    - !!defaultcommand
      name: 'Install Java 11 JDK'
      command: '.scripts/installJava11jdk.cmd'
    - !!defaultcommand
      name: 'Install Java 7 JRE'
      command: '.scripts/installJava7jre.cmd'
    - !!defaultcommand
      name: 'Clean and Resolve Dependencies'
      command: '.scripts/gradle.cmd'
      arguments: 'clean resolveDependencies --info --stacktrace --refresh-dependencies'
build:
  commands:
    - !!buildcommand
      name: 'Assemble ApplicationInsights-Java JARs'
      command: '.scripts/gradle.cmd'
      arguments: 'assemble --info --stacktrace'
      artifacts:
        - to: 'Artifacts'
          include:
            - '**/build/libs/*.jar'
    - !!defaultcommand
      name: 'Checks for ApplicationInsights-Java'
      command: '.scripts/gradle.cmd'
      arguments: 'check --info --stacktrace -x test'
      logs:
        - to: 'Checks Reports'
          include:
            - '**/build/reports/**/*'
          exclude:
            - '**/build/reports/tests/**/*'
    - !!testcommand
      name: 'Run ApplicationInsights-Java Unit Tests'
      command: '.scripts/gradle.cmd'
      arguments: 'test --info --stacktrace'
      fail_on_stderr: false
      testresults:
        - title: 'ApplicationInsights-Java Unit Tests'
          type: 'junit'
          include:
            - '**/build/test-results/test/*.xml'
      logs:
        - to: 'Test Logs'
          include:
            - '**/build/reports/test/**/*'
